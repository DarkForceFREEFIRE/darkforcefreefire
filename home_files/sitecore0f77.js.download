function ShowSimpleModal(n,t,i,r,u){var s={},f=document.createElement("div"),e,o,c,v,l,a,h;return f.id="simpleModal",f.className="simpleModal",e=document.createElement("div"),e.className="simpleModalContent",s.rootElement=f,s.close=function(){f.remove()},o=document.createElement("div"),o.className="simpleModalHeader",i?(c=document.createElement("span"),c.className="fa fa-times simpleModalClose",c.onclick=s.close,v=document.createElement("div"),v.innerHTML=n,o.appendChild(c),o.appendChild(v)):o.innerHTML=n,l=document.createElement("div"),l.className="simpleModalBody",l.innerHTML=t,a=document.createElement("div"),a.className="simpleModalFooter",r!==undefined&&(h=document.createElement("button"),h.innerText=r,h.className="modalButton",h.onclick=function(){u(s)},a.appendChild(h)),e.appendChild(o),e.appendChild(l),e.appendChild(a),f.appendChild(e),document.body.append(f),s}function preloadPage(n){$.get(`/views/${n}`,function(t){pageMap.set(n,t)})}function doPreload(){preloadPage("home");preloadPage("blog");preloadPage("faq");preloadPage("about")}function doNavNavigation(n){doNavigation(n);window.innerWidth<=600&&NavBarToggle_Click()}function doNavigation(n,t,i,r){function f(i){if(doc1=document.createElement("ok"),doc1.innerHTML=i,cont=doc1.querySelector("#PageContent"),r?$(".layout").append(cont):($("body .layout .content-wrapper #mainView").append(cont),$("body .layout .content-wrapper #mainView").append(e)),updateNavBarIcon(n),typeof viewData.onViewEnter=="function"){console.log("viewEnter: "+n);viewData.onViewEnter(t)}updateDownloadButtons();updateImageLightbox()}orgFileName=n;r&&$(".layout").empty();var u=$("#mainView"),e=u.find(".footer");if(u.empty(),viewData={},viewData.blogJson=blogJsonCache,viewData.blogId=NaN,n.startsWith("blog")&&(n="blog",initialNavigation&&(initialNavigation=!1,i=!0),viewData.blogId=orgFileName.split("/")[1],(viewData.blogId=parseInt(viewData.blogId))==NaN)){$("#mainView").append("<h1>Expected Blog ID to be a number<h1>");updateNavBarIcon("blog");return}pageMap.has(n)?f(pageMap.get(n)):$.get(`/views/${n}`,function(t){pageMap.set(n,t);f(t)}).fail(function(){$("#mainView").append("<h1>A error has occured while retrieving the view.<h1>");updateNavBarIcon(n)});window.location.pathname==="/"+n||i||history.pushState({},"User Navigation",window.location.origin+"/"+n)}function updateNavBarIcon(n){document.querySelectorAll(".sidebar-nav ul li a").forEach(t=>{t.getAttribute("navtarget").includes(`${n}`)?t.classList.add("selected"):t.classList.remove("selected")})}function updateImageLightbox(){document.querySelectorAll("#forceImgFullScreen").forEach(n=>{n.onclick=function(){window.open(n.src.replace("min","max"))}})}function handleUnhandledError(n,t){t&&$(".layout").empty();ShowSimpleModal("<h4>System Error<h4>","Error: "+n,!t,"Refresh",function(n){window.location.href=window.location.href;t||n.close()})}function handleErrorCode(n,t){handleUnhandledError(t+": HTTP status "+n,!0)}async function initBlogsList(){var e,n,s,i,r,u,t,o,f;const h="/api/Blogs/Get";try{const c=await fetch(h);if(c.ok){const h=await c.json();if(blogJsonCache=h,h.length==0)$("#BlogsList").text("There are no blogs to show.");else{$("#BlogsList").text("");e=0;for(const c of h)if(n=document.createElement("div"),n.className="blog-post",s=new Date(c.posted),i=document.createElement("div"),i.className="blog-title",i.innerText=c.title,r=document.createElement("div"),r.className="blog-date",r.innerText=s.toLocaleDateString(),u=document.createElement("div"),u.className="blog-stats",t=document.createElement("span"),t.className="info-eye",o=document.createElement("i"),o.className="icon fas fa-eye",f=document.createElement("p"),f.innerText=c.viewCount,f.style.display="inline",t.appendChild(o),t.appendChild(f),u.appendChild(t),n.appendChild(i),n.appendChild(r),n.appendChild(u),n.onclick=function(){doNavigation("blog/"+c.id,null,!0)},$("#BlogsList").append(n),e++,e==5)break}}else handleErrorCode(c.status,"Failed to load blogs list")}catch(c){handleUnhandledError("DbQueryBlogsList failed: "+c.message,!0)}}async function updateDownloadButtonFromJson(n){Array.from(document.getElementsByClassName("download-button")).forEach(function(t){var i=!1;n.exists||n.downloadLink?(i=!0,t.setAttribute("href",n.downloadLink),t.onclick=function(){window.open(n.downloadLink)}):t.setAttribute("disabled","");t.children[1].innerText=n.version!==undefined?"Version "+n.version+" ("+n.sizeStr+")":i?"Latest version":"No releases"})}async function updateDownloadButtons(){if(latestReleaseJson===""){const t="/api/System/QueryLatestRelease";try{const n=await fetch(t);if(n.ok){const t=await n.json();latestReleaseJson=t;siteVersionString=t.siteVersion;updateDownloadButtonFromJson(latestReleaseJson)}else handleErrorCode(n.status,"QueryLatestRelease failed")}catch(n){console.error(n);handleUnhandledError("QueryLatestRelease failed: "+n.message,!0)}}else updateDownloadButtonFromJson(latestReleaseJson)}function LoginButton_Click(){ShowSimpleModal("Login","Sign in not implemented!",!0,"Cancel",function(n){n.close()})}function SignupButton_Click(){ShowSimpleModal("Sign up","Sign up not implemented!",!0,"Cancel",function(n){n.close()})}function NavBarToggle_Click(){var n=document.getElementsByClassName("sidebar")[0];n.classList.toggle("collapsed")}function initAuth(){var n=document.getElementsByClassName("auth-button login")[0],t=document.getElementsByClassName("auth-button signup")[0];n.onclick=LoginButton_Click;t.onclick=SignupButton_Click}async function initHeader(){var t=document.getElementById("toggle"),n;t.onclick=NavBarToggle_Click;n=document.getElementById("logoBox");n.onclick=function(){doNavigation("home")};await initBlogsList();await updateDownloadButtons();setTimeout(doPreload,500)}var latestReleaseJson="",blogJsonCache,initialNavigation=!0,menuShowing=!0,viewedBlogs;let pageMap=new Map;viewedBlogs=new Map;$(document).ready(async function(){var n=window.location.pathname.replace("/","");n===""&&(n="home");await initHeader();n.startsWith("blog")?doNavigation(n,null,!0):(updateDownloadButtons(),updateNavBarIcon(n),updateImageLightbox());initialNavigation=!1})